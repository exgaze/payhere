##payhere 백엔드 과제 전형
- 지원자 강현수
<br>

## 과제 진행 기간
- 2022-12-19 ~ 2022-12-22
<br>

## 기술 스택
- Python
- Django
- Pyjwt
- Bcrypt
- MySQL
- CORS Header
- Git
- Freezegun
- pyshortner
<br>

## 과제 개관
- 소비내역을 기록, 관리할 수 있는 db 및 api 구현
- MySQL의 경우 5.7버전으로 개발, 그 외의 다른 모든 기술은 최신 버전을 이용함
- 서버와 db는 로컬환경을 이용
- Secret key, db 및 해싱 알고리즘은 git이 추적하지 않도록 함
- 단, 알고리즘의 경우는 HS256을 이용함

<br>

## 구현 사항

#### 회원가입
- 이메일과 비밀번호를 이용하여 회원가입이 가능하고, 로그인이 가능하도록 구현
- 정규표현식을 이용하여 이메일의 유효성을 검사
- 입력 가능한 비밀번호에 별도의 제한을 두지 않았음. 필요시 view를 수정할 수 있음
- 전달받은 비밀번호를 bcrypt를 이용하여 암호화 한 후, UTF-8로 다시 해석하여 문자형 타입으로 바꾼 후, db에 저장
- 이미 가입한 이메일인 경우, 비밀번호 혹은 이메일이 누락된 경우, 유효하지 않은 이메일인 경우, 오류 메세지를 반환
- 회원가입이 성공한 경우, 각각의 오류메세지를 반환 해야 하는 경우에 대해 테스트케이스 작성
<br>

#### 로그인 및 인증
- 로그인을 시도할 경우, 전달받은 이메일과 비밀번호의 정보를 db와 비교
- 일치하는 유저가 있는 경우, db에 저장된 user의 id정보를 바탕으로 pyjwt를 이용하여 엑세스 토큰을 발행함
- 발행한 토큰의 유효기간은 하루로 정하였음
- 일치하는 이메일이 db에 존재하지 않는 경우, 비밀번호가 일치하지 않는 경우, 이메일이나 비밀번호가 누락된 경우 오류 메세지를 반환
- 로그인한 상태임을 검증하는 함수를 utils.py에 구현
- request header의 Authorization부분에 토큰 저장 여부를 확인
- 토큰을 decode하고, 동일한 id를 가진 유저 정보를 반환함
- 토큰이 없는 경우, 다른 토큰인 경우, 기간이 만료된 경우, 동일한 유저가 없는 경우 오류 메세지를 반환
- 로그인이 성공한 경우, 각각의 이유로 실패한 경우에 대한 테스트케이스 작성
<br>

#### 가계부
- db는 세부 내역 단위로 저장하며, 날짜, 지출금액, 유저를 외래키로 작성
- 세부내역에 대한 메모는 별개의 테이블로 분리
- 반드시 로그인이 되어있어야 접근 가능하도록 구현
- 작성 기능의 경우, 지출 날짜, 내역, 메모를 작성하도록 구현
- 특정 일자의 세부 지출 내역과 메모를 보여주는 화면과, 지금까지 작성한 일별 세부 지출 내역의 합을 보여주는 화면으로 나누어 구현
- 후자의 화면은 account/list로 url을 부여하였고, 전자의 화면은 account/history/<년월일>로 부여
- 수정 또한 작성기능과 비슷하게 날짜, 내역, 메모를 수정하되, 누락된 정보는 수정이 없는 것으로 간주하여 기존 정보로 남도록 구현
- url은 account/history/<id>로 부여함. pathparameter가 세부내역부분과 겹칠 수 있는 부분은 http method를 다르게 함으로 해결
- 삭제 기능은 수정과 같은 url을 부여하였으나, 역시 method를 다르게 함으로 해결
- 관련 테스트케이스 작성
- 세부 내역 복제의 경우 구현하지 못함
<br>

#### 단축URL
- 본래의 url과 단축한 url, 유효여부를 db에 저장
- 단축 url의 경우, pyshortner를 이용하여 생성
- 유효기간은 발행 후 30분으로 제한
- 사용가능한 화면 거의 모두가 로그인된 상태를 요구하므로, 로그인을 한 상태여야 요청이 가능하도록 구현
- 단축 url을 생성하도록 화면에서 요청하면, request body에 현재의 url을 전부 담아서 보내도록 요구
- 도착한 url에 클라이언트의 토큰이 저장한 id를 더하여 단축 url을 생성
- db에는 원래의 url, 단축 url의 해싱된 부분을 저장
- 반환 값에 생성한 단축url주소를 넣어 반환함
- 리다이렉트 엔드포인트는 프로젝트의 url.py에 직접 매핑
- path parameter로 해싱된 url부분을 받고, 이를 db와 비교
- url이 이미 만료되었는지 여부를 검사하여, 만료된 경우 db의 유효 부분을 false로 바꾼 후 만료되었음을 반환
- 유효한 url인 경우, db에 저장된 본래의 url을 바로 리다이렉트함
- 리다이렉트 기능자체는 로그인을 하지 않아도 가능하지만, 리다이렉트 대상 페이지가 로그인을 요구하는 경우에는 로그인 페이지로 이동하게 됨
- 단축url의 만료 여부를 테스트하기 위해 freezegun을 이용하여 테스트
- 그외 관련 테스트케이스 작성
<br>

## 미진한 부분, 개선사항
- 구현하지 못한 세부내역 복사의 경우, txt파일을 java로 작성이 가능했었던 경험을 고려시, python으로도 가능하리라 예상
- 파일을 프론트에서 전달받아본 적은 있으나, 보낸적이 없어 관련 부분을 추가로 찾아보아야 할 것
- 단축url의 경우, 서로 다른 유저의 단축url이 같지않도록 하기 위해 id를 더하여 생성하긴 했으나, 패턴을 다양화하기 위한 다른 방안이 필요
- 전반적으로 url패턴이 단순하고 중복되는 부분이 있어 pathparameter를 별도로 재처리하여 다양화할 수 있을지 고민할 필요 있음
- 본래 requirement.txt파일을 생성하여 사용한 툴을 공유해야하나, 새로운 가상환경 세팅 중 생긴 해결하지 못한 문제로 인해 기존의 가상환경에서 작업하여 만들지 못함

이상입니다. 이 과제로 추가적인 기회와 인연이 이어졌으면 좋겠습니다. 감사합니다.
